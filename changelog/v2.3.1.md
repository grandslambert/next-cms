# Version 2.3.1 - Taxonomies & Terms API

**Release Date:** October 17, 2025

This release adds complete Taxonomies and Terms API endpoints for managing categories, tags, and custom taxonomies via the REST API.

## Added

### Taxonomies API
Complete CRUD operations for taxonomy management.

**Endpoints:**
- `GET /api/v1/taxonomies` - List all taxonomies with term counts
- `GET /api/v1/taxonomies/:id` - Get single taxonomy with post types
- `POST /api/v1/taxonomies` - Create custom taxonomy
- `PUT /api/v1/taxonomies/:id` - Full update
- `PATCH /api/v1/taxonomies/:id` - Partial update
- `DELETE /api/v1/taxonomies/:id` - Delete taxonomy (with protection for defaults)

**Features:**
- Automatic term counting
- Associated post types retrieval
- Multi-site aware
- Permission checking (`manage_taxonomies`)
- Activity logging
- Default taxonomy protection (category, tag)

### Terms API
Complete CRUD operations for taxonomy terms (categories, tags, custom terms).

**Endpoints:**
- `GET /api/v1/terms` - List terms with advanced filtering
- `GET /api/v1/terms/:id` - Get single term with relationships
- `POST /api/v1/terms` - Create term with meta support
- `PUT /api/v1/terms/:id` - Full update
- `PATCH /api/v1/terms/:id` - Partial update
- `DELETE /api/v1/terms/:id` - Delete term

**Features:**
- Filter by taxonomy (by ID or name)
- Filter by parent (hierarchical support)
- Search in name and description
- Relationship includes:
  - `parent` - Parent term details
  - `children` - Child terms
  - `image` - Featured image
  - `meta` - Custom meta fields
  - `posts` - Recent posts (10 most recent)
- Automatic slug generation from name
- Slug uniqueness validation per taxonomy
- Meta fields support (stored in `site_X_term_meta`)
- Hierarchical parent-child relationships
- Children deletion protection
- Circular parent relationship prevention
- Multi-site aware
- Permission checking (`manage_taxonomies`)
- Activity logging

### Authentication Improvements
- Added `permissions` object to `AuthenticatedRequest` user
- Permissions loaded from user's role on authentication
- Both JWT and API key authentication now include permissions
- Permissions parsed from JSON in roles table

### Documentation
- Complete API documentation for Taxonomies (`/api/v1/taxonomies/README.md`)
- Complete API documentation for Terms (`/api/v1/terms/README.md`)
- PowerShell test suite (`test-taxonomies-terms-api.ps1`)
- 20 comprehensive tests covering all endpoints

## Fixed
- Authentication middleware now loads user permissions from roles table
- Permissions correctly parsed from JSON and included in auth context

## Testing
All 20 tests passing successfully:
- âœ… Taxonomies: List, Get, Create, Update, Delete
- âœ… Terms: List, Filter (by taxonomy, parent), Create (with hierarchy), Get (with includes), Update, Delete
- âœ… Search functionality
- âœ… Hierarchical relationships
- âœ… Meta fields
- âœ… Cleanup and cascading deletes

## Technical Details

### New Files
**API Endpoints:**
- `app/api/v1/taxonomies/route.ts` - Taxonomies list and create
- `app/api/v1/taxonomies/[id]/route.ts` - Single taxonomy operations
- `app/api/v1/terms/route.ts` - Terms list and create
- `app/api/v1/terms/[id]/route.ts` - Single term operations

**Documentation:**
- `app/api/v1/taxonomies/README.md` - Complete taxonomies API docs
- `app/api/v1/terms/README.md` - Complete terms API docs

**Testing:**
- `test-taxonomies-terms-api.ps1` - Comprehensive test suite

### Modified Files
- `lib/api/auth-middleware.ts` - Added permissions to AuthenticatedRequest interface and loading logic

### Database Schema Compliance
All queries correctly reference the actual database schema:
- Taxonomies table: `site_X_taxonomies`
  - Fields: id, name, label, singular_label, description, hierarchical, public, show_in_menu, show_in_dashboard, menu_position
- Terms table: `site_X_terms`
  - Fields: id, taxonomy_id, name, slug, description, parent_id, image_id, count
- Term Meta table: `site_X_term_meta`
  - Fields: id, term_id, meta_key, meta_value
- Term Relationships: `site_X_term_relationships`
  - Fields: post_id, term_id

## API Usage Examples

### List Categories
```bash
curl -X GET "http://localhost:3000/api/v1/terms?taxonomy=category" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### Create Custom Taxonomy
```bash
curl -X POST "http://localhost:3000/api/v1/taxonomies" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "product_category",
    "label": "Product Categories",
    "singular_label": "Product Category",
    "hierarchical": true
  }'
```

### Create Hierarchical Term
```bash
curl -X POST "http://localhost:3000/api/v1/terms" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "taxonomy_id": 1,
    "name": "JavaScript",
    "parent_id": 5,
    "meta": {"color": "#f7df1e"}
  }'
```

### Get Term with Children
```bash
curl -X GET "http://localhost:3000/api/v1/terms/1?include=children,meta,posts" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## Migration Notes
No database migrations required. Uses existing schema.

## Breaking Changes
None. This is a new feature addition.

## Next Steps
- Media API (Phase 4 continued)
- Pages API
- Menus API

---

**Phase 4 Progress: 2/5 Complete**
- âœ… Taxonomies API
- âœ… Terms API
- ðŸš§ Media API (next)
- ðŸš§ Pages API
- ðŸš§ Menus API

