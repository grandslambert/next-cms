# Version 3.0.4 - 2025-10-21

## Fixed

- **Terms Management**
  - Migrated terms API routes to multi-database architecture
  - Fixed term create/edit/delete functionality
  - Fixed activity logging for term operations
  - Ensured proper `siteId` usage for database routing

- **Settings**
  - Fixed critical auth import bug in `lib/api-helpers.ts` that prevented settings from saving
  - Fixed General Settings loading (changed `site_name` to `site_title` to match database)
  - Added missing `posts_per_page` field to General Settings
  - Added missing `max_revisions` field to General Settings
  - Fixed settings group assignment (media settings now correctly grouped as 'media')
  - Removed redundant image dimension settings from initialization scripts
  - Added `image_sizes` JSON setting to replace individual width/height settings

- **Media Settings**
  - Added file type management UI (add/remove allowed MIME types)
  - Added max upload size configuration
  - Improved layout and made image size inputs more compact
  - Fixed settings persistence to database

- **Post Types**
  - Added `show_in_menu` field to control sidebar visibility independently from dashboard
  - Fixed `show_in_menu` not being saveable in UI
  - Added `show_in_menu` checkbox to post type form
  - Fixed `featured_image` support not saving (mapped to `thumbnail` in backend)

- **Taxonomies**
  - Fixed `menu_position` not saving correctly (now handles `0` as valid value)
  - Fixed sidebar filtering to use `show_in_menu` instead of `show_in_dashboard`
  - Added missing `singular_label` to API response

- **Admin UI**
  - Fixed sidebar spacing (added padding between site switcher and dashboard button)
  - Fixed sidebar filtering to properly check `show_in_menu` for both post types and taxonomies
  - Fixed Content Types menu not showing for users with proper permissions
  - Removed parent menu items that have no visible subitems

## Changed

- **Database Initialization**
  - Updated default settings to match new structure (9 settings instead of 13)
  - Changed default `session_timeout` from 30 minutes to 1440 minutes (24 hours)
  - Removed redundant individual image dimension settings
  - Added `max_revisions` to default settings
  - Synchronized settings between `init-mongodb.ts` and `init-site-defaults.ts`

- **API Routes**
  - Improved error handling and logging in settings API
  - Added debug logging for settings updates

## Technical

- Fixed import path for `authOptions` in `lib/api-helpers.ts`
- Ensured consistent `siteId` usage across all term-related operations
- Improved type safety with proper casting for Mongoose `.lean()` results
- Updated settings group logic to correctly categorize media settings

