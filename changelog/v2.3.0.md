# Version 2.3.0 - REST API v1 (Headless CMS)

**Release Date:** October 17, 2025

This major feature release introduces a complete REST API v1 for headless CMS functionality, enabling Next CMS to power any frontend application.

## Added

### REST API v1 Foundation
Complete headless CMS API infrastructure with modern best practices.

**API Structure & Versioning**:
- Versioned API endpoints at `/api/v1/`
- API root endpoint with documentation and feature list
- Health check endpoint for monitoring
- Comprehensive API documentation (README.md)
- CORS support with configurable origins
- OPTIONS handlers for preflight requests

**Response Standardization**:
- Consistent JSON response format with success/error states
- Standardized error codes and messages (400, 401, 403, 404, 409, 422, 429, 500, 503)
- Pagination support with navigation links (prev, next, first, last)
- Metadata in all responses (timestamp, version)
- Pre-built error response helpers

**Request Validation**:
- Required field validation
- Pagination validation (page, per_page with 100 item limit)
- Sort parameter validation with field whitelisting
- Field selection validation for sparse fieldsets
- Email, URL, and date format validation
- String length validation
- Enum value validation

**Authentication & Security**:
- JWT token-based authentication
- Access tokens (1 hour expiry, configurable)
- Refresh tokens (7 days expiry, configurable)
- Token blacklisting for logout
- API key authentication support
- Bearer token extraction and validation
- Rate limiting (in-memory, 100/hour unauthenticated, 1000/hour authenticated)
- Multi-site support via headers or query params

**Authentication Endpoints**:
- `POST /api/v1/auth/login` - User authentication with JWT token generation
- `POST /api/v1/auth/refresh` - Refresh access token using refresh token
- `POST /api/v1/auth/logout` - Logout with token blacklisting
- `GET /api/v1/auth/me` - Get current authenticated user details

**Authentication Features**:
- bcrypt password hashing
- Role-based authentication (super_admin, admin, editor, author, contributor, guest)
- Permission checking middleware
- Activity logging for login/logout events
- Account status validation
- Site assignment support

**Developer Tools**:
- Complete API documentation with examples
- Authentication flow documentation
- curl examples for testing
- PowerShell examples for Windows
- Error response documentation
- Implementation progress tracker

### Posts API
Complete CRUD operations for posts with advanced filtering and relationships.

**List Posts** (`GET /api/v1/posts`):
- Pagination with configurable page size (max 100 items)
- Advanced filtering by status, author, date range, post type
- Full-text search in title and content
- Sorting by multiple fields (ascending/descending)
- Include related resources (author, categories, tags, featured_image)
- Navigation links (prev, next, first, last)

**Get Single Post** (`GET /api/v1/posts/:id`):
- Complete post details
- Include author, categories, tags, featured_image, revisions
- SEO metadata (title, description, keywords) from post_meta
- Custom fields support

**Create Post** (`POST /api/v1/posts`):
- Automatic slug generation from title
- Support for all post types
- Status management (draft, pending, published, scheduled, private)
- Category and tag associations
- Featured image assignment
- SEO fields stored in post_meta
- Custom fields (JSON object) stored in post_meta
- Activity logging

**Update Post** (`PUT /api/v1/posts/:id`):
- Full post updates with slug regeneration
- Category and tag management
- All fields updatable

**Partial Update** (`PATCH /api/v1/posts/:id`):
- Update only specified fields
- Efficient for status changes or quick edits

**Delete Post** (`DELETE /api/v1/posts/:id`):
- Soft delete support
- Activity logging
- Cascade deletion of related data

**Features**:
- Multi-site aware (all operations site-specific)
- Authentication required
- Activity logging for all operations
- Automatic author assignment
- Conflict detection (duplicate slugs)
- Comprehensive error handling
- CORS support
- Meta fields stored in `site_X_post_meta` table (SEO, custom fields)
- Taxonomy relationships via `site_X_term_relationships` table

## Fixed
- Correct table names used throughout API:
  - Using `site_X_term_relationships` instead of `site_X_post_terms`
  - Using `site_X_post_meta` for SEO and custom fields instead of columns in posts table
  - Using `tax.name` instead of `tax.slug` for taxonomy filtering
- User authentication now correctly joins with roles table for role information
- Activity log entries use correct column names (`entity_name`, `details`)
- Display names dynamically constructed from `first_name` and `last_name`
- Site ID correctly determined from authenticated user's JWT payload

## Technical Details

### New Dependencies
- `jsonwebtoken` (^9.0.2) - JWT token generation and verification
- `@types/jsonwebtoken` (^9.0.7) - TypeScript types for jsonwebtoken

### New Files
**API Infrastructure**:
- `lib/api/response.ts` - Standardized API response helpers
- `lib/api/validation.ts` - Request validation utilities
- `lib/api/middleware.ts` - API middleware (context, CORS, rate limiting)
- `lib/api/jwt.ts` - JWT token generation and verification
- `lib/api/auth-middleware.ts` - Authentication and authorization middleware

**API Endpoints**:
- `app/api/v1/route.ts` - API root with documentation
- `app/api/v1/health/route.ts` - Health check endpoint
- `app/api/v1/auth/login/route.ts` - Login endpoint
- `app/api/v1/auth/refresh/route.ts` - Token refresh endpoint
- `app/api/v1/auth/logout/route.ts` - Logout endpoint
- `app/api/v1/auth/me/route.ts` - Current user endpoint
- `app/api/v1/posts/route.ts` - Posts list and create
- `app/api/v1/posts/[id]/route.ts` - Single post operations

**Documentation**:
- `app/api/v1/README.md` - Complete API documentation
- `app/api/v1/IMPLEMENTATION.md` - Implementation progress tracker
- `app/api/v1/auth/README.md` - Authentication documentation
- `app/api/v1/posts/README.md` - Posts API documentation

**Testing**:
- `test-api.ps1` - Comprehensive PowerShell test suite

### Database Schema Alignment
All API queries correctly reference the actual database schema:
- Posts table contains only core fields (title, slug, content, excerpt, status, etc.)
- Meta fields (seo_title, seo_description, seo_keywords, custom_fields) stored in `site_X_post_meta`
- Term relationships stored in `site_X_term_relationships` (not post_terms)
- Taxonomies filtered by `name` field (not slug)
- Users table has `first_name` and `last_name` (not display_name)

## API Testing
A comprehensive test suite (`test-api.ps1`) validates all endpoints:
- ✅ Health check
- ✅ Authentication (login, logout, refresh, user info)
- ✅ Posts CRUD (create, read, update, delete)
- ✅ Pagination & sorting
- ✅ Status filtering
- ✅ Related resource includes (author, categories, tags)
- ✅ Token blacklisting on logout
- ✅ Meta fields (SEO, custom fields)

**All 17 tests pass successfully.**

## Migration Notes
No database migrations required. The API uses the existing database schema correctly.

## Breaking Changes
None. This is a new feature addition that doesn't affect existing admin functionality.

## Next Steps
Future API endpoints planned:
- Media API (upload, manage, search media)
- Taxonomies API (manage categories, tags, custom taxonomies)
- Users API (user management)
- Sites API (multi-site management)
- Settings API (site configuration)
- Custom Post Types API

---

For detailed API usage, see `/app/api/v1/README.md`

